"use strict";var mvxAfmLibrary=function($){return{datePickerSelect:function(a){var b=$(a).is(".sale_price_dates_from")?"minDate":"maxDate",c="minDate"===b?$(a).closest(".sale_price_dates_fields").find(".sale_price_dates_to"):$(a).closest(".sale_price_dates_fields").find(".sale_price_dates_from"),d=$(a).datepicker("getDate");$(c).datepicker("option",b,d),$(a).change()},wcEnhancedSelectInit:function(){try{$(":input.wc-enhanced-select, :input.chosen_select").filter(":not(.enhanced)").each(function(){var a={minimumResultsForSearch:10,allowClear:!!$(this).data("allow_clear"),placeholder:$(this).data("placeholder")};$(this).selectWoo(a).addClass("enhanced")}),$(":input.wc-product-search").filter(":not(.enhanced)").each(function(){var a={allowClear:!!$(this).data("allow_clear"),placeholder:$(this).data("placeholder"),minimumInputLength:$(this).data("minimum_input_length")?$(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:mvx_advance_product_params.ajax_url,dataType:"json",delay:250,data:function(a){return{term:a.term,action:$(this).data("action")||"woocommerce_json_search_products_and_variations",security:mvx_advance_product_params.search_products_nonce,exclude:$(this).data("exclude"),include:$(this).data("include"),limit:$(this).data("limit")}},processResults:function(a){var b=[];return a&&$.each(a,function(a,c){b.push({id:a,text:c})}),{results:b}},cache:!0}};if($(this).selectWoo(a).addClass("enhanced"),$(this).data("sortable")){var c=$(this),b=$(this).next(".select2-container").find("ul.select2-selection__rendered");b.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){$(b.find(".select2-selection__choice").get().reverse()).each(function(){var a=$(this).data("data").id,b=c.find('option[value="'+a+'"]')[0];c.prepend(b)})}})}else $(this).prop("multiple")&&$(this).on("change",function(){var a=$(this).children();a.sort(function(c,d){var a=c.text.toLowerCase(),b=d.text.toLowerCase();return a>b?1:a<b?-1:0}),$(this).html(a)})})}catch(a){window.console.log(a)}},wcEnhancedSelectClose:function(){try{$("html").on("click",function(a){this===a.target&&$(".wc-enhanced-select, :input.wc-product-search").filter(".select2-hidden-accessible").selectWoo("close")})}catch(a){window.console.log(a)}},qtip:function(){$(".img_tip").each(function(){$(this).qtip({content:$(this).attr("data-desc"),position:{my:"top center",at:"bottom center",viewport:$(window)},show:{event:"mouseover",solo:!0},hide:{inactive:6e3,fixed:!0},style:{classes:"qtip-dark qtip-shadow qtip-rounded qtip-dc-css",width:200}})})}}}(jQuery),mvxAfmProductEditor=function($){var a={productType:$("select#product-type").val(),manageStock:$("input#_manage_stock").is(":checked")},b=null,c=null,d=null;return{getState:function(b){return a.hasOwnProperty(b)?a[b]:""},setState:function(b,c){return!!a.hasOwnProperty(b)&&!!c&&(a[b]=c,!0)},init:function(){$("#woocommerce-product-data").on("change","select#product-type",this.productTypeChanged.bind(this)).on("change","input#_downloadable, input#_virtual",this.updateTabsDisplay.bind(this)).on("click",".sale_schedule",this.showSalePriceDates).on("click",".cancel_sale_schedule",this.hideSalePriceDates).on("change","input#_manage_stock",this.stockManagementPreferenceChanged.bind(this)),$(".add-product-single").on("click",".notice-wrapper button.notice-dismiss",this.dismissNotice),$("#mvx-edit-product-form").on("click","#mvx_frontend_dashboard_product_submit, #mvx_frontend_dashboard_product_draft",this.saveProduct.bind(this)),$("#mvx-edit-product-form").on("change",'ul.taxonomy-widget input[name^="tax_input"]',this.taxInputChanged.bind(this)),b=this.mediaController(),c=this.downloadsController(),d=this.attributeController(),this.setupEnvironment()},mediaController:function(){var a=null,b=null,c=$("#product_image_gallery");return{init:function(){$(".featured-img").on("click",".upload_image_button:not(.remove)",this.addFeaturedImage).on("click",".upload_image_button.remove",this.removeFeaturedImage),$("#product_images_container").on("click",".add_product_images a",this.addGalleryImages).on("click",".product_images a.delete",this.removeGalleryImage),this.initGalleryImagesSort()},addFeaturedImage:function(c){var b=$(this),d=b.closest(".upload_image");if(c.preventDefault(),a){a.open();return}(a=wp.media.frames.featured_image=wp.media({title:b.data("title"),button:{text:b.data("button")},states:[new wp.media.controller.Library({title:b.data("title"),filterable:"all"})]})).on("select",function(){var b=a.state().get("selection").first().toJSON(),c=b.sizes&&b.sizes.medium?b.sizes.medium.url:b.url;$(".upload_image_id",d).val(b.id).change(),d.find(".upload_image_button").addClass("remove"),d.find("img").eq(0).attr("src",c)}),a.open()},removeFeaturedImage:function(b){b.preventDefault();var a=$(this).closest(".upload_image");$(".upload_image_id",a).val("").change(),a.find("img").eq(0).attr("src",mvx_advance_product_params.woocommerce_placeholder_img_src),a.find(".upload_image_button").removeClass("remove")},addGalleryImages:function(d){var a=$(this),e=$("#product_images_container").find("ul.product_images");if(d.preventDefault(),b){b.open();return}(b=wp.media.frames.product_gallery=wp.media({title:a.data("choose"),button:{text:a.data("update")},states:[new wp.media.controller.Library({title:a.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){var d=b.state().get("selection"),f=c.val();d.map(function(b){if((b=b.toJSON()).id){f=f?f+","+b.id:b.id;var c=b.sizes&&b.sizes.thumbnail?b.sizes.thumbnail.url:b.url;e.append('<li class="image" data-attachment_id="'+b.id+'"><img src="'+c+'" /><ul class="actions"><li><a href="#" class="delete" title="'+a.data("delete")+'">'+a.data("text")+"</a></li></ul></li>")}}),c.val(f)}),b.open()},removeGalleryImage:function(){$(this).closest("li.image").remove();var a="";return $("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var b=$(this).attr("data-attachment_id");a=a+b+","}),c.val(a),!1},initGalleryImagesSort:function(){$("#product_images_container").find("ul.product_images").sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"product-image-gallery-placeholder",start:function(b,a){a.item.css("background-color","#f6f6f6")},stop:function(b,a){a.item.removeAttr("style")},update:function(){var a="";$("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var b=$(this).attr("data-attachment_id");a=a+b+","}),c.val(a)}})}}},downloadsController:function(){var a,b;return{init:function(){$("#woocommerce-product-data").on("click",".downloadable_files a.insert",this.insertDownloadableFiles).on("click",".downloadable_files a.delete",this.deleteDownloadableFiles).on("click",".downloadable_files a.upload_file_button",this.fileUploaded).on("downloadable_file_fields_inserted",this.sortDownloadableFiles)},insertDownloadableFiles:function(){return $(this).closest(".downloadable_files").find("tbody").append($(this).data("row")),!1},deleteDownloadableFiles:function(){return $(this).closest("tr").remove(),!1},fileUploaded:function(d){var c=$(this);if(b=c.closest("tr").find("td.file_url input"),d.preventDefault(),a){a.open();return}var e=[new wp.media.controller.Library({library:wp.media.query(),multiple:!0,title:c.data("choose"),priority:20,filterable:"uploaded"})];(a=wp.media.frames.downloadable_file=wp.media({title:c.data("choose"),library:{type:""},button:{text:c.data("update")},multiple:!0,states:e})).on("select",function(){var c="";a.state().get("selection").map(function(a){(a=a.toJSON()).url&&(c=a.url)}),b.val(c).change()}),a.on("ready",function(){a.uploader.options.uploader.params={type:"downloadable_product"}}),a.open()},sortDownloadableFiles:function(){$(".downloadable_files tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"span.sortable-icon",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"downloadable-files-sortable-placeholder",start:function(b,a){a.item.css("background-color","#f6f6f6")},stop:function(b,a){a.item.removeAttr("style")}})}}},setupEnvironment:function(){$("select#product-type").change(),$("input#_manage_stock").change(),mvxAfmLibrary.wcEnhancedSelectInit(),mvxAfmLibrary.wcEnhancedSelectClose(),mvxAfmLibrary.qtip(),b.init(),c.init(),d.init(),this.salePriceDateFieldInit($("#woocommerce-product-data")),$("#woocommerce-product-data").trigger("downloadable_file_fields_inserted"),$(".multiselect.product_tag").select2({tags:mvx_advance_product_params.add_tags,tokenSeparators:[","],placeholder:$(this).data("placeholder")}).on("change",function(){var a=$(this).find('[data-select2-tag="true"]');if(a.length){var b={action:"mvx_product_tag_add",new_tag:a.val(),security:mvx_advance_product_params.add_attribute_nonce};$.ajax({type:"POST",url:mvx_advance_product_params.ajax_url,data:b,success:function(b){if(b.status){var c=b.tag?b.tag.term_id:a.val();a.replaceWith('<option selected value="'+c+'">'+a.val()+"</option>")}else""!=b.message&&($(".woocommerce-error,woocommerce-message").remove(),$("#mvx-frontend-dashboard-add-product").prepend('<div class="woocommerce-error" tabindex="-1">'+b.message+"</div>"),$(".woocommerce-error").focus()),$('.multiselect.product_tag option[value="'+a.val()+'"]').remove()}})}}),$("#product_data_tabs").afmTabInit()},salePriceDateFieldInit:function(a){$(".sale_price_dates_fields",a).each(function(){var b=$(this),c=!1,a=b.closest("div.form-group-row");b.find("input").each(function(){""!==$(this).val()&&(c=!0),mvxAfmLibrary.datePickerSelect($(this))}),c?(a.find(".sale_schedule").hide(),a.find(".sale_price_dates_fields").show()):(a.find(".sale_schedule").show(),a.find(".sale_price_dates_fields").hide())})},productTypeChanged:function(){var a=$("select#product-type").val();this.setState("productType",a),"variable"===a?($("input#_manage_stock").change(),$("input#_downloadable").prop("checked",!1),$("input#_virtual").removeAttr("checked")):"grouped"===a?($("input#_downloadable").prop("checked",!1),$("input#_virtual").removeAttr("checked")):"external"===a&&($("input#_downloadable").prop("checked",!1),$("input#_virtual").removeAttr("checked")),$("#woocommerce-product-data").trigger("afm-product-type-changed"),this.updateTabsDisplay(),$("ul#product_data_tabs li:visible").eq(0).find("a").tab("show")},updateTabsDisplay:function(){var a=this.getState("productType"),b=$("input#_virtual:checked").length,c=$("input#_downloadable:checked").length,e=".hide_if_downloadable, .hide_if_virtual",f=".show_if_downloadable, .show_if_virtual",g=JSON.parse(mvx_advance_product_params.default_product_types),d=JSON.parse(mvx_advance_product_params.product_types);$.extend(d,g),$.each(d,function(a,b){e=e+", .hide_if_"+a,f=f+", .show_if_"+a}),$(e).show(),$(f).hide(),c&&$(".show_if_downloadable").show(),b&&$(".show_if_virtual").show(),$(".show_if_"+a).show(),c&&$(".hide_if_downloadable").hide(),b&&$(".hide_if_virtual").hide(),$(".hide_if_"+a).hide(),$("input#_manage_stock").change(),$(".tab-pane").each(function(){var a=$(this).find(".row-padding > div");if(0!==a.length&&a.filter(function(){return"none"===$(this).css("display")}).length===a.length){var b=$(this).prop("id");$("#product_data_tabs").find('li a[href="#'+b+'"]').parent().hide()}}),$("#product_data_tabs").trigger("tab-display-updated")},showSalePriceDates:function(){var a=$(this).closest("div.form-group-row");return $(this).hide(),a.find(".cancel_sale_schedule").show(),a.find(".sale_price_dates_fields").show(),!1},hideSalePriceDates:function(){var a=$(this).closest("div.form-group-row");return $(this).hide(),a.find(".sale_schedule").show(),a.find(".sale_price_dates_fields").hide(),a.find(".sale_price_dates_fields").find("input").val(""),!1},stockManagementPreferenceChanged:function(){var a=this.getState("productType"),b=$("input#_manage_stock").is(":checked");this.setState("manageStock",b),b?($("div.stock_fields:not( .hide_if_"+a+" )").show(),$("div.stock_status_field").hide()):($("div.stock_fields").hide(),$("div.stock_status_field:not( .hide_if_"+a+" )").show())},attributeController:function(){var a=this;return{init:function(){var a=$(".product_attributes").find(".woocommerce_attribute").get();$(a).each(function(b,a){$(a).is(".taxonomy")&&$("select.attribute_taxonomy").find('option[value="'+$(a).data("taxonomy")+'"]').attr("disabled","disabled")}),mvx_advance_product_params.custom_attribute||this.customAttributeCapCheck(),this.initSortableComponent(),$("#product_attributes_data").on("change","input.attribute_name",this.changeCustomAttributeName).on("click","button.select_all_attributes",this.selectAllAttributes).on("click","button.select_no_attributes",this.removeAllAttributes).on("click","button.add_attribute",this.addAttribute.bind(this)).on("click","a.remove_row",this.removeAttribute.bind(this)).on("click",".save_attributes",this.saveAttribute.bind(this)).on("click",".expand_all",this.expandAllAttributes).on("click",".close_all",this.closeAllAttributes)},customAttributeCapCheck:function(){var a=$("select.attribute_taxonomy").children(":not([disabled=disabled])").first().val();a?$("select.attribute_taxonomy").val(a):$("button.add_attribute").attr("disabled","disabled")},initSortableComponent:function(){var a=this;$(".product_attributes").sortable({items:".woocommerce_attribute",cursor:"move",axis:"y",handle:".variation-title",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"mvx-metabox-sortable-placeholder",start:function(b,a){a.item.css("background-color","#f6f6f6")},stop:function(c,b){b.item.removeAttr("style"),a.updateRowIndices()}})},changeCustomAttributeName:function(){$(this).closest(".woocommerce_attribute").find("strong.attribute_name").text($(this).val())},selectAllAttributes:function(){return $(this).closest("td").find("select option").attr("selected","selected"),$(this).closest("td").find("select").change(),!1},removeAllAttributes:function(){return $(this).closest("td").find("select option").removeAttr("selected"),$(this).closest("td").find("select").change(),!1},updateRowIndices:function(){$(".product_attributes .woocommerce_attribute").each(function(b,a){$(".attribute_position",a).val(parseInt($(a).index(".product_attributes .woocommerce_attribute"),10))})},addAttribute:function(h){var i=this,d=$(".product_attributes .woocommerce_attribute").get(),c=0;d.length>0&&(c=d.reduce(function(b,c){var a=parseInt($(c).find(".woocommerce_attribute_data").attr("id").replace("attribute_",""),10);return isNaN(a)||b>a?b:a},0),++c);var b=$("select.attribute_taxonomy").val();if(b||"1"==mvx_advance_product_params.custom_attribute){var e=$("#product_attributes_data"),j=e.find(".product_attributes"),k=a.getState("productType"),g={action:"mvx_edit_product_attribute",taxonomy:b,i:c,security:mvx_advance_product_params.add_attribute_nonce};e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),$.post(mvx_advance_product_params.ajax_url,g,function(a){"-1"!=a&&(j.append(a),"variable"!==k&&j.find(".enable_variation").hide(),mvxAfmLibrary.wcEnhancedSelectInit(),mvxAfmLibrary.qtip(),i.updateRowIndices(),j.find(".woocommerce_attribute").last().find(".variation-title").click(),$("#product_attributes_data").trigger("attribute_added")),e.unblock()})}if(b){if($("select.attribute_taxonomy").find('option[value="'+b+'"]').attr("disabled","disabled"),1==mvx_advance_product_params.custom_attribute)$("select.attribute_taxonomy").val("");else{var f=$("select.attribute_taxonomy").children(":not([disabled=disabled])").first().val();f?$("select.attribute_taxonomy").val(f):$("button.add_attribute").attr("disabled","disabled")}}return!1},removeAttribute:function(b){if(window.confirm(mvx_advance_product_params.remove_attribute)){var a=$(b.target).closest(".woocommerce_attribute");a.is(".taxonomy")&&$("select.attribute_taxonomy").find('option[value="'+a.data("taxonomy")+'"]').removeAttr("disabled"),a.remove(),this.updateRowIndices()}return!1},saveAttribute:function(d){var b=$("#woocommerce-product-data");b.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var c={post_id:mvx_advance_product_params.product_id,product_type:a.getState("productType"),data:$(".product_attributes").find("input, select, textarea").serialize(),action:"mvx_product_save_attributes",security:mvx_advance_product_params.save_attributes_nonce};$.post(mvx_advance_product_params.ajax_url,c,function(){var a=window.location.toString();a=a.replace(/(?:\/#?|\/\d+\/?)?$/,"/"+mvx_advance_product_params.product_id+"/"),b.unblock(),b.trigger("mvx_after_save_attribute_triggered")})},expandAllAttributes:function(){return $(this).closest("#product_attributes_data").find(".mvx-metabox-wrapper > .mvx-metabox-content").collapse("show"),!1},closeAllAttributes:function(){return $(this).closest("#product_attributes_data").find(".mvx-metabox-wrapper > .mvx-metabox-content").collapse("hide"),!1}}},variationController:function(){var a=this,b=null,c=null,d=null,e=null;return{init:function(){(b=this.variationActionsController()).init(),(c=this.variationAjaxController()).init(),(d=this.variationMediaController()).init(),(e=this.variationPaginationController()).init()},variationActionsController:function(){return{init:function(){$("#variable_product_options").on("change","input.variable_is_downloadable",this.variableIsDownloadable).on("change","input.variable_is_virtual",this.variableIsVirtual).on("change","input.variable_manage_stock",this.variableManageStock).on("click",".woocommerce_variation span.sort.sortable-icon",this.setMenuOrder).on("click",".variation-title select, .variation-title .remove_row",this.stopToggle).on("click",".expand_all",this.expandAllVariations).on("click",".close_all",this.closeAllVariations).on("reload",this.reload),$("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock").change(),$("#woocommerce-product-data").on("woocommerce_variations_loaded",this.variationsLoaded),$(document.body).on("woocommerce_variations_added",this.variationAdded)},initSortableComponent:function(){$(".woocommerce_variations").sortable({items:".woocommerce_variation",cursor:"move",axis:"y",handle:".variation-title",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"variation-sortable-placeholder",start:function(b,a){a.item.css("background-color","#f6f6f6")},stop:function(c,a){a.item.removeAttr("style"),b.variationRowIndexes()}})},expandAllVariations:function(){return $(this).closest("#variable_product_options").find(".mvx-metabox-wrapper > .mvx-metabox-content").collapse("show"),!1},closeAllVariations:function(){return $(this).closest("#variable_product_options").find(".mvx-metabox-wrapper > .mvx-metabox-content").collapse("hide"),!1},reload:function(){c.loadVariations(1),e.setPaginav(0)},variableIsDownloadable:function(){$(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_downloadable").hide(),$(this).is(":checked")&&$(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_downloadable").show()},variableIsVirtual:function(){$(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_virtual").show(),$(this).is(":checked")&&$(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_virtual").hide()},variableManageStock:function(){$(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_manage_stock").hide(),$(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_manage_stock").show(),$(this).is(":checked")&&($(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_manage_stock").show(),$(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_manage_stock").hide())},stopToggle:function(a){a.stopPropagation()},variationsLoaded:function(e,d){d=d||!1;var c=$("#woocommerce-product-data");d||($("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock",c).change(),$(".woocommerce_variation",c).each(function(e,b){var a=$(b),c=$(".sale_price_dates_from",a).val(),d=$(".sale_price_dates_to",a).val();(""!==c||""!==d)&&$("a.sale_schedule",a).click()}),$(".woocommerce_variations .variation-needs-update",c).removeClass("variation-needs-update"),$("button.cancel-variation-changes, button.save-variation-changes",c).attr("disabled","disabled")),a.salePriceDateFieldInit(c),mvxAfmLibrary.wcEnhancedSelectInit(),mvxAfmLibrary.qtip(),b.initSortableComponent(),$("#woocommerce-product-data").trigger("downloadable_file_fields_inserted")},variationAdded:function(c,a){1===a&&b.variationsLoaded(null,!0)},setMenuOrder:function(d){d.preventDefault();var a=$(this).closest(".woocommerce_variation").find(".variation_menu_order"),b=parseInt(window.prompt(mvx_advance_product_params.i18n_enter_menu_order,a.val()),10);return isNaN(b)||(a.val(b).change(),c.saveVariations()),!1},variationRowIndexes:function(){var a=$("#variable_product_options").find(".woocommerce_variations"),b=parseInt(a.attr("data-page"),10),c=parseInt((b-1)*mvx_advance_product_params.variations_per_page,10);$(".woocommerce_variations .woocommerce_variation").each(function(b,a){$(".variation_menu_order",a).val(parseInt($(a).index(".woocommerce_variations .woocommerce_variation"),10)+1+c).change()})}}},variationAjaxController:function(){return{init:function(){$("li.variations_tab a").on("click",this.initialLoad),$("#variable_product_options").on("click","button.save-variation-changes",this.saveVariations).on("click","button.cancel-variation-changes",this.cancelVariations).on("click",".remove_variation",this.removeVariation),$(document.body).on("change","#variable_product_options .woocommerce_variations :input",this.inputChanged).on("change",".variations-defaults select",this.defaultsChanged),$("form#mvx-frontend-dashboard-add-product").on("submit",this.saveOnSubmit),$(".collapsable-component-wrapper").on("click","a.do_variation_action",this.doVariationAction)},checkForChanges:function(){var a=$("#variable_product_options").find(".woocommerce_variations .variation-needs-update");if(0<a.length){if(!window.confirm(mvx_advance_product_params.i18n_edited_variations))return a.removeClass("variation-needs-update"),!1;this.saveChanges()}return!0},block:function(){$("#woocommerce-product-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){$("#woocommerce-product-data").unblock()},initialLoad:function(){0===$("#variable_product_options").find(".woocommerce_variations .woocommerce_variation").length&&e.goToPage()},loadVariations:function(a,b){a=a||1,b=b||mvx_advance_product_params.variations_per_page;var d=$("#variable_product_options").find(".woocommerce_variations");c.block(),$.ajax({url:mvx_advance_product_params.ajax_url,data:{action:"mvx_frontend_dashboard_load_variations",security:mvx_advance_product_params.load_variations_nonce,product_id:mvx_advance_product_params.product_id,attributes:d.data("attributes"),page:a,per_page:b},type:"POST",success:function(b){d.empty().append(b).attr("data-page",a),$("#woocommerce-product-data").trigger("woocommerce_variations_loaded"),c.unblock()}})},getVariationsFields:function(a){var b=$(":input",a).serializeJSON();return $(".variations-defaults select").each(function(d,c){var a=$(c);b[a.attr("name")]=a.val()}),b},saveChanges:function(f){var e=$("#variable_product_options").find(".woocommerce_variations"),d=$(".variation-needs-update",e),b={};0<d.length&&(c.block(),(b=this.getVariationsFields(d)).action="woocommerce_save_variations",b.security=mvx_advance_product_params.save_variations_nonce,b.product_id=mvx_advance_product_params.product_id,b["product-type"]=a.getState("productType"),$.ajax({url:mvx_advance_product_params.ajax_url,data:b,type:"POST",success:function(a){d.removeClass("variation-needs-update"),$("button.cancel-variation-changes, button.save-variation-changes").attr("disabled","disabled"),$("#woocommerce-product-data").trigger("woocommerce_variations_saved"),"function"==typeof f&&f(a),c.unblock()}}))},saveVariations:function(){return $("#variable_product_options").trigger("woocommerce_variations_save_variations_button"),c.saveChanges(function(a){var b=$("#variable_product_options").find(".woocommerce_variations"),c=b.attr("data-page");$("#variable_product_options").find("#woocommerce_errors").remove(),a&&b.before(a),$(".variations-defaults select").each(function(){$(this).attr("data-current",$(this).val())}),e.goToPage(c)}),!1},saveOnSubmit:function(a){0<$("#variable_product_options").find(".woocommerce_variations .variation-needs-update").length&&(a.preventDefault(),$("#variable_product_options").trigger("woocommerce_variations_save_variations_on_submit"),c.saveChanges(c.saveOnSubmitDone))},saveOnSubmitDone:function(){$("form#post").submit()},cancelVariations:function(){var a=parseInt($("#variable_product_options").find(".woocommerce_variations").attr("data-page"),10);return $("#variable_product_options").find(".woocommerce_variations .variation-needs-update").removeClass("variation-needs-update"),$(".variations-defaults select").each(function(){$(this).val($(this).attr("data-current"))}),e.goToPage(a),!1},addVariation:function(){this.block();var a={action:"mvx_frontend_dashboard_add_variation",post_id:mvx_advance_product_params.product_id,loop:$(".woocommerce_variation").length,security:mvx_advance_product_params.add_variation_nonce};return $.post(mvx_advance_product_params.ajax_url,a,function(b){var a=$(b);a.addClass("variation-needs-update"),$("#variable_product_options").find(".woocommerce_variations").prepend(a),$("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),$("#variable_product_options").trigger("woocommerce_variations_added",1),c.unblock()}),!1},removeVariation:function(){if(c.checkForChanges(),window.confirm(mvx_advance_product_params.i18n_remove_variation)){var b=$(this).attr("rel"),d=[],a={action:"woocommerce_remove_variations"};c.block(),0<b?(d.push(b),a.variation_ids=d,a.security=mvx_advance_product_params.delete_variations_nonce,$.post(mvx_advance_product_params.ajax_url,a,function(){var d=$("#variable_product_options").find(".woocommerce_variations"),b=parseInt(d.attr("data-page"),10),a=Math.ceil((parseInt(d.attr("data-total"),10)-1)/mvx_advance_product_params.variations_per_page),c=1;$("#woocommerce-product-data").trigger("woocommerce_variations_removed"),b===a||b<=a?c=b:b>a&&0!==a&&(c=a),e.goToPage(c,-1)})):c.unblock()}return!1},linkAllVariations:function(){if(this.checkForChanges(),window.confirm(mvx_advance_product_params.i18n_link_all_variations)){this.block();var a={action:"woocommerce_link_all_variations",post_id:mvx_advance_product_params.product_id,security:mvx_advance_product_params.link_variation_nonce};$.post(mvx_advance_product_params.ajax_url,a,function(b){var a=parseInt(b,10);1===a?window.alert(a+" "+mvx_advance_product_params.i18n_variation_added):0===a||a>1?window.alert(a+" "+mvx_advance_product_params.i18n_variations_added):window.alert(mvx_advance_product_params.i18n_no_variations_added),a>0?(e.goToPage(1,a),$("#variable_product_options").trigger("woocommerce_variations_added",a)):c.unblock()})}return!1},inputChanged:function(){$(this).closest(".woocommerce_variation").addClass("variation-needs-update"),$("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),$("#variable_product_options").trigger("woocommerce_variations_input_changed")},defaultsChanged:function(){$(this).closest("#variable_product_options").find(".woocommerce_variation:first").addClass("variation-needs-update"),$("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),$("#variable_product_options").trigger("woocommerce_variations_defaults_changed")},doVariationAction:function(){var d,f=$("select.variation_actions").val(),b={},g=0;switch(f){case"add_variation":c.addVariation();return;case"link_all_variations":c.linkAllVariations();return;case"delete_all":window.confirm(mvx_advance_product_params.i18n_delete_all_variations)&&window.confirm(mvx_advance_product_params.i18n_last_warning)&&(b.allowed=!0,g=-1*parseInt($("#variable_product_options").find(".woocommerce_variations").attr("data-total"),10));break;case"variable_regular_price_increase":case"variable_regular_price_decrease":case"variable_sale_price_increase":case"variable_sale_price_decrease":if(null===(d=window.prompt(mvx_advance_product_params.i18n_enter_a_value_fixed_or_percent)))return;d.indexOf("%")>=0?b.value=accounting.unformat(d.replace(/\%/,""),mvx_advance_product_params.mon_decimal_point)+"%":b.value=accounting.unformat(d,mvx_advance_product_params.mon_decimal_point);break;case"variable_regular_price":case"variable_sale_price":case"variable_stock":case"variable_weight":case"variable_length":case"variable_width":case"variable_height":case"variable_download_limit":case"variable_download_expiry":if(null===(d=window.prompt(mvx_advance_product_params.i18n_enter_a_value)))return;b.value=d;break;case"variable_sale_schedule":if(b.date_from=window.prompt(mvx_advance_product_params.i18n_scheduled_sale_start),b.date_to=window.prompt(mvx_advance_product_params.i18n_scheduled_sale_end),null===b.date_from&&(b.date_from=!1),null===b.date_to&&(b.date_to=!1),!1===b.date_to&& !1===b.date_from)return;break;default:$("select.variation_actions").trigger(f),b=$("select.variation_actions").triggerHandler(f+"_ajax_data",b)}"delete_all"===f&&b.allowed?$("#variable_product_options").find(".variation-needs-update").removeClass("variation-needs-update"):c.checkForChanges(),c.block(),$.ajax({url:mvx_advance_product_params.ajax_url,data:{action:"woocommerce_bulk_edit_variations",security:mvx_advance_product_params.bulk_edit_variations_nonce,product_id:mvx_advance_product_params.product_id,product_type:a.getState("productType"),bulk_action:f,data:b},type:"POST",success:function(){e.goToPage(1,g)}})}}},variationMediaController:function(){var a=null,b=null,c=null,d=wp.media.model.settings.post.id;return{init:function(){$("#variable_product_options").on("click",".upload_image_button",this.addImage),$("a.add_media").on("click",this.restoreWPMediaPostId)},addImage:function(f){var e=$(this),g=e.attr("rel"),h=e.closest(".upload_image");if(c=h,b=g,f.preventDefault(),e.is(".remove"))$(".upload_image_id",c).val("").change(),c.find("img").eq(0).attr("src",mvx_advance_product_params.woocommerce_placeholder_img_src),c.find(".upload_image_button").removeClass("remove");else{if(a){a.uploader.uploader.param("post_id",b),a.open();return}wp.media.model.settings.post.id=b,(a=wp.media.frames.variable_image=wp.media({title:mvx_advance_product_params.i18n_choose_image,button:{text:mvx_advance_product_params.i18n_set_image},states:[new wp.media.controller.Library({title:mvx_advance_product_params.i18n_choose_image,filterable:"all"})]})).on("select",function(){var b=a.state().get("selection").first().toJSON(),e=b.sizes&&b.sizes.thumbnail?b.sizes.thumbnail.url:b.url;$(".upload_image_id",c).val(b.id).change(),c.find(".upload_image_button").addClass("remove"),c.find("img").eq(0).attr("src",e),wp.media.model.settings.post.id=d}),a.open()}},restoreWPMediaPostId:function(){wp.media.model.settings.post.id=d}}},variationPaginationController:function(){return{init:function(){$(document.body).on("woocommerce_variations_added",this.updateSingleQuantity).on("change",".variations-pagenav .page-selector",this.pageSelector).on("click",".variations-pagenav .first-page",this.firstPage).on("click",".variations-pagenav .prev-page",this.prevPage).on("click",".variations-pagenav .next-page",this.nextPage).on("click",".variations-pagenav .last-page",this.lastPage)},updateVariationsCount:function(d){var b=$("#variable_product_options").find(".woocommerce_variations"),a=parseInt(b.attr("data-total"),10)+d,c=$(".variations-pagenav .displaying-num");return b.attr("data-total",a),1===a?c.text(mvx_advance_product_params.i18n_variation_count_single.replace("%qty%",a)):c.text(mvx_advance_product_params.i18n_variation_count_plural.replace("%qty%",a)),a},updateSingleQuantity:function(c,b){if(1===b){var a=$(".variations-pagenav");e.updateVariationsCount(b),a.is(":hidden")&&($("option, optgroup",".variation_actions").show(),$(".variation_actions").val("add_variation"),$("#variable_product_options").find(".toolbar").show(),a.show(),$(".pagination-links",a).hide())}},setPaginav:function(i){var j=$("#variable_product_options").find(".woocommerce_variations"),e=this.updateVariationsCount(i),f=$("#variable_product_options").find(".toolbar"),d=$(".variation_actions"),a=$(".variations-pagenav"),g=$(".pagination-links",a),b=Math.ceil(e/mvx_advance_product_params.variations_per_page),h="";j.attr("data-total_pages",b),$(".total-pages",a).text(b);for(var c=1;c<=b;c++)h+='<option value="'+c+'">'+c+"</option>";$(".page-selector",a).empty().html(h),0===e?(f.not(".toolbar-top, .toolbar-buttons").hide(),a.hide(),$("option, optgroup",d).hide(),$(".variation_actions").val("add_variation"),$('option[data-global="true"]',d).show()):(f.show(),a.show(),$("option, optgroup",d).show(),$(".variation_actions").val("add_variation"),1===b?g.hide():g.show())},checkIsEnabled:function(a){return!$(a).hasClass("disabled")},changeClasses:function(a,f){var b=$(".variations-pagenav .first-page"),c=$(".variations-pagenav .prev-page"),d=$(".variations-pagenav .next-page"),e=$(".variations-pagenav .last-page");1===a?(b.addClass("disabled"),c.addClass("disabled")):(b.removeClass("disabled"),c.removeClass("disabled")),f===a?(d.addClass("disabled"),e.addClass("disabled")):(d.removeClass("disabled"),e.removeClass("disabled"))},setPage:function(a){$(".variations-pagenav .page-selector").val(a).first().change()},goToPage:function(a,b){a=a||1,b=b||0,this.setPaginav(b),this.setPage(a)},pageSelector:function(){var a=parseInt($(this).val(),10),b=$("#variable_product_options").find(".woocommerce_variations");$(".variations-pagenav .page-selector").val(a),c.checkForChanges(),e.changeClasses(a,parseInt(b.attr("data-total_pages"),10)),c.loadVariations(a)},firstPage:function(){return e.checkIsEnabled(this)&&e.setPage(1),!1},prevPage:function(){if(e.checkIsEnabled(this)){var b=$("#variable_product_options").find(".woocommerce_variations"),a=parseInt(b.attr("data-page"),10)-1,c=0<a?a:1;e.setPage(c)}return!1},nextPage:function(){if(e.checkIsEnabled(this)){var a=$("#variable_product_options").find(".woocommerce_variations"),b=parseInt(a.attr("data-total_pages"),10),c=parseInt(a.attr("data-page"),10)+1,d=b>=c?c:b;e.setPage(d)}return!1},lastPage:function(){if(e.checkIsEnabled(this)){var a=$("#variable_product_options").find(".woocommerce_variations").attr("data-total_pages");e.setPage(a)}return!1}}}}},dismissNotice:function(){$(this).parent().remove()},getTinymceContent:function(a){return $("#wp-"+a+"-wrap").hasClass("tmce-active")&&"undefined"!=typeof tinyMCE&&tinyMCE.get(a)?tinyMCE.get(a).getContent():$("textarea#"+a).val()},saveProduct:function(a){$("form#mvx-edit-product-form").trigger("before_product_save");var b="mvx_frontend_dashboard_product_submit"===a.target.id?"publish":"mvx_frontend_dashboard_product_draft"===a.target.id?"draft":"";return $('input:hidden[name="status"]').val(b),$("textarea#product_description").val(this.getTinymceContent("product_description")),$("textarea#product_excerpt").val(this.getTinymceContent("product_excerpt")),!0},taxInputChanged:function(a){$(this).is(":checked")||$(this).prop("checked",!1)}}}(jQuery);jQuery(function(){mvxAfmProductEditor.init()})