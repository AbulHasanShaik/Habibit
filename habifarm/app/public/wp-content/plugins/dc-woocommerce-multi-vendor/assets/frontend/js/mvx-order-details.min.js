jQuery(function($){var a={init:function(){$("#mvx-order-details").on("click","button.refund-items",this.refund_items).on("click",".cancel-action",this.cancel).on("click","button.do-api-refund, button.do-manual-refund",this.refunds.do_refund).on("change",".refund input.refund_line_total, .refund input.refund_line_tax",this.refunds.input_changed).on("change keyup",".mvx-order-refund-items #refund_amount",this.refunds.amount_changed).on("change","input.refund_order_item_qty",this.refunds.refund_quantity_changed).on("change","input.quantity",this.quantity_changed).on("click","#order_status a",this.order_status_changed).on("keyup change",".split-input :input",function(){var a=$(this).parent().prev().find(":input");a&&(""===a.val()||a.is(".match-total"))&&a.val($(this).val()).addClass("match-total")}).on("keyup",".split-input :input",function(){$(this).removeClass("match-total")})},block:function(){$("#mvx-order-details").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){$("#mvx-order-details").unblock()},quantity_changed:function(){var a=$(this).closest("tr.item"),b=$(this).val(),c=$(this).attr("data-qty"),d=$("input.line_total",a),e=$("input.line_subtotal",a),f=accounting.unformat(d.attr("data-total"),mvx_order_details_js_script_data.mon_decimal_point)/c;d.val(parseFloat(accounting.formatNumber(f*b,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point));var g=accounting.unformat(e.attr("data-subtotal"),mvx_order_details_js_script_data.mon_decimal_point)/c;e.val(parseFloat(accounting.formatNumber(g*b,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point)),$("input.line_tax",a).each(function(){var d=$(this),h=d.data("tax_id"),e=accounting.unformat(d.attr("data-total_tax"),mvx_order_details_js_script_data.mon_decimal_point)/c,f=$('input.line_subtotal_tax[data-tax_id="'+h+'"]',a),g=accounting.unformat(f.attr("data-subtotal_tax"),mvx_order_details_js_script_data.mon_decimal_point)/c;0<e&&d.val(parseFloat(accounting.formatNumber(e*b,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point)),0<g&&f.val(parseFloat(accounting.formatNumber(g*b,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point))}),$(this).trigger("quantity_changed")},order_status_changed:function(){var a=$(this).data("status"),b=$("#order_current_status").val(),c=$("#order_ID").val();if($(this).parents(".change-status").find(".order-status-text").removeClass(function(b,a){return(a.match(/(^|\s)wc\S+/g)||[]).join(" ")}).addClass(a),b==a)return $(".change-status").removeClass("loaderOverlay"),$(".dropdown-order-statuses").removeClass("open"),!1;if("wc-cancelled"==a){if(!window.confirm(mvx_order_details_js_script_data.i18n_do_cancel))return!1}else if("wc-cancelled"==b)return!1;$(".change-status").addClass("loaderOverlay");var d={action:"mvx_order_status_changed",order_id:c,selected_status:a,security:mvx_order_details_js_script_data.grant_access_nonce};$.post(mvx_order_details_js_script_data.ajax_url,d,function(a){a&&($(".order_status_lbl").html(""),"wc-cancelled"==a.status_key&&$(".dropdown-order-statuses").hide(),$(".order_status_lbl").html(a.status_name),$("#order_current_status").val(a.status_key),$(".change-status").removeClass("loaderOverlay"))})},refund_items:function(){return $("div.mvx-order-refund-items").slideDown(),$("div.mvx-order-data-row-toggle").not("div.mvx-order-refund-items").slideUp(),$("div.mvx-order-totals-items").slideUp(),$("#mvx-order-details").find("div.refund").show(),!1},cancel:function(){return $("div.mvx-order-data-row-toggle").not("div.mvx-order-actions").slideUp(),$("div.mvx-order-actions").slideDown(),$("div.mvx-order-totals-items").slideDown(),$("#mvx-order-details").find("div.refund").hide(),!1},refunds:{do_refund:function(){if(a.block(),window.confirm(mvx_order_details_js_script_data.i18n_do_refund)){var b=$("input#refund_amount").val(),c=$("input#refund_reason").val(),d=$("input#refunded_amount").val(),e={},f={},g={};$(".refund input.refund_order_item_qty").each(function(b,a){$(a).closest("tr").data("order_item_id")&&a.value&&(e[$(a).closest("tr").data("order_item_id")]=a.value)}),$(".refund input.refund_line_total").each(function(b,a){$(a).closest("tr").data("order_item_id")&&(f[$(a).closest("tr").data("order_item_id")]=accounting.unformat(a.value,mvx_order_details_js_script_data.mon_decimal_point))}),$(".refund input.refund_line_tax").each(function(c,a){if($(a).closest("tr").data("order_item_id")){var b=$(a).data("tax_id");g[$(a).closest("tr").data("order_item_id")]||(g[$(a).closest("tr").data("order_item_id")]={}),g[$(a).closest("tr").data("order_item_id")][b]=accounting.unformat(a.value,mvx_order_details_js_script_data.mon_decimal_point)}});var h={action:"mvx_do_refund",order_id:mvx_order_details_js_script_data.post_id,refund_amount:b,refunded_amount:d,refund_reason:c,line_item_qtys:JSON.stringify(e,null,""),line_item_totals:JSON.stringify(f,null,""),line_item_tax_totals:JSON.stringify(g,null,""),api_refund:$(this).is(".do-api-refund"),restock_refunded_items:$("#restock_refunded_items:checked").length?"true":"false",security:mvx_order_details_js_script_data.order_item_nonce};$.post(mvx_order_details_js_script_data.ajax_url,h,function(b){!0===b.success?window.location.href=window.location.href:(window.alert(b.data.error),window.location.href=window.location.href,a.unblock())})}else a.unblock()},input_changed:function(){var a=0;$(".woocommerce_order_items").find("tr.item, tr.fee, tr.shipping").each(function(){$(this).find(".refund input:not(.refund_order_item_qty)").each(function(c,b){a+=parseFloat(accounting.unformat($(b).val()||0,mvx_order_details_js_script_data.mon_decimal_point))})}),$("#refund_amount").val(accounting.formatNumber(a,mvx_order_details_js_script_data.currency_format_num_decimals,"",mvx_order_details_js_script_data.mon_decimal_point)).change()},amount_changed:function(){var a=accounting.unformat($(this).val(),mvx_order_details_js_script_data.mon_decimal_point);$("button .wc-order-refund-amount .amount").text(accounting.formatMoney(a,{symbol:mvx_order_details_js_script_data.currency_format_symbol,decimal:mvx_order_details_js_script_data.currency_format_decimal_sep,thousand:mvx_order_details_js_script_data.currency_format_thousand_sep,precision:mvx_order_details_js_script_data.currency_format_num_decimals,format:mvx_order_details_js_script_data.currency_format}))},refund_quantity_changed:function(){var a=$(this).closest("tr.item"),c=a.find("input.quantity").val(),b=$(this).val(),d=$("input.line_total",a),e=$("input.refund_line_total",a),f=accounting.unformat(d.attr("data-total"),mvx_order_details_js_script_data.mon_decimal_point)/c;e.val(parseFloat(accounting.formatNumber(f*b,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point)).change(),$(".refund_line_tax",a).each(function(){var d=$(this),f=$('input.line_tax[data-tax_id="'+d.data("tax_id")+'"]',a),e=accounting.unformat(f.data("total_tax"),mvx_order_details_js_script_data.mon_decimal_point)/c;0<e?d.val(parseFloat(accounting.formatNumber(e*b,mvx_order_details_js_script_data.rounding_precision,"")).toString().replace(".",mvx_order_details_js_script_data.mon_decimal_point)).change():d.val(0).change()}),b>0?$("#restock_refunded_items").closest("tr").show():($("#restock_refunded_items").closest("tr").hide(),$(".woocommerce_order_items input.refund_order_item_qty").each(function(){$(this).val()>0&&$("#restock_refunded_items").closest("tr").show()})),$(this).trigger("refund_quantity_changed")}}};a.init(),({init:function(){$(".date-picker").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0}),$(".order_download_permissions").on("click","button.grant_access",this.grant_access).on("click","button.revoke_access",this.revoke_access).on("click","#copy-download-link",this.copy_link).on("aftercopy","#copy-download-link",this.copy_success).on("aftercopyfailure","#copy-download-link",this.copy_fail)},grant_access:function(){var a=$("#grant_access_id").val();if(a){$(".order_download_permissions").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var b={action:"mvx_grant_access_to_download",product_ids:a,loop:$(".order_download_permissions .wc-metabox").length,order_id:mvx_order_details_js_script_data.post_id,security:mvx_order_details_js_script_data.grant_access_nonce};return $.post(mvx_order_details_js_script_data.ajax_url,b,function(a){a?$(".order_download_permissions .wc-metaboxes").append(a):window.alert(mvx_order_details_js_script_data.i18n_download_permission_fail),$(document.body).trigger("wc-init-datepickers"),$("#grant_access_id").val("").change(),$(".order_download_permissions").unblock()}),!1}},revoke_access:function(){if(window.confirm(mvx_order_details_js_script_data.i18n_permission_revoke)){var a=$(this).parent().parent(),b=$(this).attr("rel").split(",")[0],c=$(this).attr("rel").split(",")[1],d=$(this).data("permission_id");if(b>0){$(a).block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e={action:"woocommerce_revoke_access_to_download",product_id:b,download_id:c,permission_id:d,order_id:mvx_order_details_js_script_data.post_id,security:mvx_order_details_js_script_data.revoke_access_nonce};$.post(mvx_order_details_js_script_data.ajax_url,e,function(){$(a).fadeOut("300",function(){$(a).remove()})})}else $(a).fadeOut("300",function(){$(a).remove()})}return!1},copy_link:function(a){wcClearClipboard(),wcSetClipboard($(this).attr("href"),$(this)),a.preventDefault()},copy_success:function(){$(this).tipTip({attribute:"data-tip",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).focus()},copy_fail:function(){$(this).tipTip({attribute:"data-tip-failed",activation:"focus",fadeIn:50,fadeOut:50,delay:0}).focus()}}).init()})