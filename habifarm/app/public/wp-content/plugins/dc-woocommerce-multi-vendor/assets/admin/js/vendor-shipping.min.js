!function($,a,b,c){$(function(){var b=b||{build:function(){this.init(),this.bindEvents()},init:function(){this.shipping_zone_table=".mvx-shipping-zones",this.table_shipping_zone_settings=".mvx-shipping-zone-settings",this.table_shipping_zone_methods=".mvx-shipping-zone-methods",this.modify_shipping_methods=".modify-shipping-methods",this.modal_add_shipping_method=".mvx-modal-add-shipping-method-modal",this.show_shipping_methods=this.table_shipping_zone_settings+" .mvx-shipping-zone-show-method",this.add_shipping_methods=this.modal_add_shipping_method+" .mvx-shipping-zone-add-method",this.edit_shipping_methods=this.table_shipping_zone_settings+" .edit-shipping-method",this.delete_shipping_method=this.table_shipping_zone_settings+" .delete-shipping-method",this.method_status=this.table_shipping_zone_methods+" .method-status",this.limit_zone_location=this.table_shipping_zone_settings+" #limit_zone_location"},bindEvents:function(){$(this.modify_shipping_methods).on("click",this.modify_shipping_methods_admin.bind(this)),$(document).on("zone_settings_loaded",this.zoneLoadedEvents.bind(this)),$(document.body).on("click",this.show_shipping_methods,this.showShippingMethods),$(document.body).on("wc_backbone_modal_response",this.addShippingMethod),$(document.body).on("wc_backbone_modal_response",this.updateShippingMethod),$(document.body).on("click",this.edit_shipping_methods,this.editShippingMethod),$(document.body).on("click",this.delete_shipping_method,this.deleteShippingMethod),$(document.body).on("change",this.method_status,this.toggleShippingMethod),$(document.body).on("change",this.limit_zone_location,this.limitZoneLocation),$(document.body).on("change",".wc-shipping-zone-method-selector select",this.onChangeShippingMethodSelector),this.limitZoneLocation()},modify_shipping_methods_admin:function(a,b){var c=this;$(".mvx-shipping-zones").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),void 0!==a&&(a.preventDefault(),b=$(a.currentTarget).data("zoneId"),vendor_id=$(a.currentTarget).data("vendor_id")),$.ajax({method:"post",url:mvx_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:b,vendor_id:vendor_id,security:mvx_vendor_shipping_script_data.security},success:function(a){$(c.table_shipping_zone_settings).html(a).show(),$(c.shipping_zone_table).hide()},complete:function(){$(".mvx-shipping-zones").unblock(),$(document).trigger("zone_settings_loaded")}})},zoneLoadedEvents:function(a){this.limitZoneLocation(a)},showShippingMethods:function(a){a.preventDefault();var b=$("#zone_id").val();$(this).WCBackboneModal({template:"mvx-modal-add-shipping-method",variable:{zone_id:b}}),$(".wc-shipping-zone-method-selector select").change()},onChangeShippingMethodSelector:function(){var a=$(this).find("option:selected").data("description");$(this).parent().find(".wc-shipping-zone-method-description").remove(),$(this).after('<div class="wc-shipping-zone-method-description">'+a+"</div>"),$(this).closest("article").height($(this).parent().height())},addShippingMethod:function(e,f,a){if("mvx-modal-add-shipping-method"===f){e.preventDefault();var b=a.zone_id,g=a.vendor_id,d=a.mvx_shipping_method;if(""==b);else if(""==d);else{var h={action:"mvx-add-shipping-method",zoneID:b,method:d,vendor_id:g,security:mvx_vendor_shipping_script_data.security};$(this.add_shipping_methods).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),$.ajax({method:"post",url:c,data:h,success:function(a){a.success&&(g?$.ajax({method:"post",url:mvx_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:b,vendor_id:g,security:mvx_vendor_shipping_script_data.security},success:function(a){$(".mvx-shipping-zone-settings").html(a).show(),$(document).trigger("zone_settings_loaded")}}):location.reload())}})}}},editShippingMethod:function(a){a.preventDefault(),$(".mvx-shipping-zone-methods").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var b=$(a.currentTarget).data("instance_id"),d=$(a.currentTarget).data("method_id"),e=$(a.currentTarget).data("zone_id"),f=$(a.currentTarget).data("vendor_id"),g={action:"mvx-configure-shipping-method",zoneId:e,instanceId:b,methodId:d,vendor_id:f,security:mvx_vendor_shipping_script_data.security};$("#method_id_selected").val(d),$("#instance_id_selected").val(b),$.ajax({method:"post",url:c,data:g,success:function(a){a&&($(".mvx-shipping-zone-methods").unblock(),$(this).WCBackboneModal({template:"mvx-modal-update-shipping-method",variable:{methodId:d,instanceId:b,config_settings:a}}))}})},updateShippingMethod:function(d,e,a){if("mvx-modal-update-shipping-method"===e){d.preventDefault();var f=a.method_id,g=a.instance_id,b=a.zone_id,h=a.vendor_id,i={action:"mvx-update-shipping-method",zoneID:b,posted_data:a,security:mvx_vendor_shipping_script_data.security,args:{instance_id:g,zone_id:b,method_id:f,vendor_id:h,settings:{}}};$.ajax({method:"post",url:c,data:i,success:function(a){a.success?h?$.ajax({method:"post",url:mvx_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:b,vendor_id:h,security:mvx_vendor_shipping_script_data.security},success:function(a){$(".mvx-shipping-zone-settings").html(a).show(),$(document).trigger("zone_settings_loaded")}}):location.reload():alert(a.data)}})}},deleteShippingMethod:function(b){if(b.preventDefault(),confirm(a.i18n.deleteShippingMethodConfirmation)){$(b.target).is(this.delete_shipping_method)?b.target:$(b.target).closest(this.delete_shipping_method);var g=$(b.currentTarget).data("vendor_id"),d=$(b.target).attr("data-instance_id"),e=$("#zone_id").val(),f=f={action:"mvx-delete-shipping-method",zoneID:e,instance_id:d,vendor_id:g,security:mvx_vendor_shipping_script_data.security};""==e||""==d||$.ajax({method:"post",url:c,data:f,success:function(a){a.success?g?$.ajax({method:"post",url:mvx_vendor_shipping_script_data.ajaxurl,data:{action:"admin-get-vendor-shipping-methods-by-zone",zoneID:e,vendor_id:g,security:mvx_vendor_shipping_script_data.security},success:function(a){$(".mvx-shipping-zone-settings").html(a).show(),$(document).trigger("zone_settings_loaded")}}):location.reload():alert(resp.data)}})}},limitZoneLocation:function(a){$("#limit_zone_location").is(":checked")?($(".hide_if_zone_not_limited").show(),$("#select_zone_states").select2()):$(".hide_if_zone_not_limited").hide()},toggleShippingMethod:function(a){a.preventDefault();var d=$(a.target).is(":checked"),b=$(a.target).val(),e=$(a.currentTarget).data("vendor_id"),c=$("#zone_id").val(),f={action:"mvx-toggle-shipping-method",zoneID:c,instance_id:b,checked:d,vendor_id:e,security:mvx_vendor_shipping_script_data.security};""==c||""==b||($(".mvx-container").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),$.ajax({method:"post",url:mvx_vendor_shipping_script_data.ajaxurl,data:f,success:function(a){a.success?$(".mvx-container").unblock():($(".mvx-container").unblock(),alert(a.data))}}))}};$(b.build.bind(b))})}(jQuery,mvx_vendor_shipping_script_data,wp,ajaxurl)